!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],e):e(t.d3=t.d3||{},t.d3Array)}(this,function(t,e){"use strict";function r(){function t(t,n){if(null==t||void 0===t)return void console.log("barcodetree");for(var i=d3.select(t).attr("width",p+w.left+w.right).attr("height",g+w.top+w.bottom),u=i.selectAll(".container").attr("transform","translate("+w.left+","+w.top+")"),f=d(n),c=[],_=d3.extent(f,function(t){return+t.depth}),j=d3.max(f,function(t){return+t.value}),A=d3.scaleLinear().domain([0,j]).range([0,1]),N=["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],W=[],S=N.length,q=0;q<S;q++)W.push(q/S);var C=d3.scaleLinear().domain(W).range(N);if("bct_w"===T){var E=v(x,m,_);c=h(f,E,y,k,A,C,L)}else if("bct_h"===T){var H=s(y,_);c=l(f,b,H,k,A,C,L)}var M=u.selectAll(".barcodetree-node").data(c);M.enter().append("rect").attr("id",function(t){return t.name}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("fill",function(t){return t.color}).on("mouseover",function(t,e){r(t,e,c,u),o(t,e,c,u),a(t,e,c,u)}).on("mouseout",function(t,r){e(u)}),M.attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).attr("fill",function(t){return t.color}),M.exit().remove()}function e(t){t.selectAll(".structure-cue").remove()}function r(t,e,r,o){for(var i=n(t,e,r),a=t.y+t.height,u=a+_+j/2,f=0;f<i.length;f++){var c=i[f],d=c.start_x,h=c.end_x;o.append("line").attr("class","structure-cue").attr("x1",d).attr("y1",u).attr("x2",h).attr("y2",u).style("stroke","red").style("stroke-width",A+"px")}}function n(t,e,r){var n=t.depth,o=n+1,i=[];if(W){for(var a=[],u=e+1;u<r.length;u++){var f=r[u];if(f.depth===o&&0!==a.length){var d=c(a);i.push(d),a=[]}if(f.depth===n){if(0!==a.length){var d=c(a);i.push(d),a=[]}break}a.push(f)}if(0!==a.length){var d=c(a);i.push(d),a=[]}}else{for(var h=[],u=e+1;u<r.length&&(h.push(r[u]),f.depth!==n);u++);var d=c(h);i.push(d)}return i}function o(t,e,r,n){for(var o=i(t,e,r),a=t.y+t.height,u=a+_+j/2,f=0;f<o.length;f++){var c=o[f],d=c.start_x,h=c.end_x;n.append("line").attr("class","structure-cue").attr("x1",d).attr("y1",u).attr("x2",h).attr("y2",u).style("stroke","red").style("stroke-width",A+"px")}}function i(t,e,r){for(var n=t.depth,o=[],i=e;i>=0;i--){var a=r[i];if(a.depth==n){var u=[a],f=c(u);o.push(f),n-=1}}return o}function a(t,e,r,n){for(var o=u(t,e,r),i=t.y+t.height,a=i+_,f=i+_+j,c=0;c<o.length;c++){var d=o[c];n.append("line").attr("class","structure-cue").attr("x1",d).attr("y1",a).attr("x2",d).attr("y2",f).style("stroke","red").style("stroke-width",A+"px")}}function u(t,e,r){for(var n=t.depth,o=t.depth-1,i=[],a=e;a<r.length;a++){var u=r[a];if(u.depth===n){var c=f(u);i.push(c)}if(u.depth===o)break}for(var a=e-1;a>=0;a--){var u=r[a];if(u.depth===n){var c=f(u);i.push(c)}if(u.depth===o)break}return i}function f(t){return t.x+t.width/2}function c(t){for(var e=1e7,r=0,n=0;n<t.length;n++){var o=t[n],i=o.x,a=o.x+o.width;i<e&&(e=i),a>r&&(r=a)}return{start_x:e,end_x:r}}function d(t){function e(t,r){if(r.push(t),void 0!==t.children)for(var n=0;n<t.children.length;n++){var o=t.children[n];e(o,r)}}var r=[];return e(t,r),r}function h(t,e,r,n,o,i,a){for(var u=0,f=0;f<t.length;f++){var c=t[f],d=c.depth,h=c.value;c.height=r,c.width=e[d],c.x=u,c.y=0,c.color="black","color"===a?c.color=i(o(h)):"height"===a&&(c.height=o(h)*r,c.y=r-c.height),u=u+c.width+n}return t}function l(t,e,r,n,o,i,a){for(var u=0,f=r[0],c=0;c<t.length;c++){var d=t[c],h=d.depth,l=d.value;d.width=e,d.height=r[h],d.x=u,d.y=f-d.height,d.color="black","color"===a&&(d.color=i(o(l))),u=u+d.width+n}return t}function v(t,e,r){for(var n=[],o=r[1],i=r[1]-r[0],a=(t-e)/i,u=0;u<=o;u++){var f=o-u;n.push(e+a*f)}return n}function s(t,e){for(var r=[],n=e[1]+1,o=n-e[0],i=t/o,a=0;a<n;a++)r.push(t-i*a);return r}var p=600,g=350,w={right:.02*p,left:.02*p,top:.02*g,bottom:.02*g},y=40,b=10,x=20,m=2,k=5,_=.05*y,j=.1*y,A=.025*y,N=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],T="bct_h",L="color",W=!0,S=function(){},q=function(){};return t.width=function(e){return arguments.length?"number"!=typeof e?void console.warn("invalid value for width",e):(p=e,t):p},t.height=function(e){return arguments.length?"number"!=typeof e?void console.warn("invalid value for width",e):(g=e,t):g},t.margin=function(e){return arguments.length?"object"!=typeof w?void console.warn("invalid value for width",w):(w=e,t):w},t.bctNodeHeight=function(e){return arguments.length?"number"!=typeof y?void console.warn("invalid value for width",y):(y=e,t):y},t.bctNodeWidth=function(e){return arguments.length?"number"!=typeof b?void console.warn("invalid value for width",b):(b=e,t):b},t.bctRootNodeWidth=function(e){return arguments.length?"number"!=typeof x?void console.warn("invalid value for width",x):(x=e,t):x},t.bctLeafNodeWidth=function(e){return arguments.length?"number"!=typeof m?void console.warn("invalid value for width",m):(m=e,t):m},t.spacing=function(e){return arguments.length?"number"!=typeof k?void console.warn("invalid value for width",k):(k=e,t):k},t.colourScheme=function(e){return arguments.length?"object"!=typeof N?void console.warn("invalid value for width",N):(N=e,t):N},t.barcodeTreeType=function(e){return arguments.length?"string"!=typeof T?void console.warn("invalid value for width",T):(T=e,t):T},t.valueEncoding=function(e){return arguments.length?"string"!=typeof L?void console.warn("invalid value for width",L):(L=e,t):L},t.hoveringTrigger=function(e){return arguments.length?"object"!=typeof S?void console.warn("invalid value for width",S):(S=e,t):S},t.unhoveringTrigger=function(e){return arguments.length?"string"!=typeof q?void console.warn("invalid value for width",q):(q=e,t):q},t.structureCueSpacing=function(e){return arguments.length?"number"!=typeof _?void console.warn("invalid value for width",_):(_=e,t):_},t}t.barcodetree=r,Object.defineProperty(t,"__esModule",{value:!0})});